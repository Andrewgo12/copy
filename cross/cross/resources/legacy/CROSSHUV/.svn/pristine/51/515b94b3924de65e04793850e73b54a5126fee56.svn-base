<?php
include("smtpclass/smtp.php");
include("sasl/sasl.php");

class FeGeSendMailManager {
	function FeGeSendMailManager() {
		//Obtiene el servidor de correo
		settype($objervice,"object");
		settype($rcEmpresa,"array");
		settype($sbEmailServer,"string");
		$objervice = Application :: getDomainController("ParamsManager");
		$sbEmailServer = $objervice->getParam("general","email_server",false);
		$rcEmpresa = $objervice->getParam("general","empresa");
		$this->rchdrs["from"] = $rcEmpresa["empremail"];
		$this->smtp = new smtp_class;
		$this->smtp->host_name= $sbEmailServer;       /* Change this variable to the address of the SMTP server to relay, like "smtp.myisp.com" */
		$this->smtp->host_port=465;                /* Change this variable to the port of the SMTP server to use, like 465 */
		$this->smtp->ssl=1;                       /* Change this variable if the SMTP server requires an secure connection using SSL */
		//      $this->smtp->http_proxy_host_name='209.85.225.109';     /* Change this variable if you need to connect to SMTP server via an HTTP proxy */
		//      $this->smtp->http_proxy_host_port=465;   /* Change this variable if you need to connect to SMTP server via an HTTP proxy */
		$this->smtp->socks_host_name = '';        /* Change this variable if you need to connect to SMTP server via an SOCKS server */
		$this->smtp->socks_host_port = 1080;      /* Change this variable if you need to connect to SMTP server via an SOCKS server */
		$this->smtp->socks_version = '5';         /* Change this variable if you need to connect to SMTP server via an SOCKS server */

		$this->smtp->start_tls=0;                 /* Change this variable if the SMTP server requires security by starting TLS during the connection */
		$this->smtp->localhost="localhost";       /* Your computer address */
		$this->smtp->direct_delivery=0;           /* Set to 1 to deliver directly to the recepient SMTP server */
		$this->smtp->timeout=10;                  /* Set to the number of seconds wait for a successful connection to the SMTP server */
		$this->smtp->data_timeout=0;              /* Set to the number seconds wait for sending or retrieving data from the SMTP server.
		Set to 0 to use the same defined in the timeout variable */
		$this->smtp->debug=0;                     /* Set to 1 to output the communication with the SMTP server */
		$this->smtp->html_debug=0;                /* Set to 1 to format the debug output as HTML */
		$this->smtp->pop3_auth_host="";           /* Set to the POP3 authentication host if your SMTP server requires prior POP3 authentication */
		$this->smtp->user="cazapata@fullengine.com";//$this->rchdrs["from"];                     /* Set to the user name if the server requires authetication */
		$this->smtp->realm="";                    /* Set to the authetication realm, usually the authentication user e-mail domain */
		$this->smtp->password= "Jodaca.2013";//$rcEmpresa["email_pass"];                 /* Set to the authetication password */
		$this->smtp->workstation="";              /* Workstation name for NTLM authentication */
		$this->smtp->authentication_mechanism=""; /* Specify a SASL authentication method like LOGIN, PLAIN, CRAM-MD5, NTLM, etc..
		Leave it empty to make the class negotiate if necessary */
	}

	/**
	 *   Propiedad intelectual del FullEngine.
	 *
	 *   Compone y envia un email
	 *   @author freina
	 *       @return string $osbresult (true o false)
	 *   @date 14-Oct-2004 16:22
	 *   @location Cali-Colombia
	 */
	function ComposeEmail() {
		settype($sbResult,"string");
		$sbResult = $this->smtp->SendMessage($this->rchdrs["from"],
		array(
		$this->sbrecipient,
		),
		array(
                        "From: ".$this->rchdrs["from"],
                        "To: ".$this->sbrecipient,
                        "Subject: ".$this->rchdrs["subject"],
                        "Date: ".strftime("%a, %d %b %Y %H:%M:%S %Z")
		),
		$this->sbhtml);
		if($sbResult){
			return true;
		}else{
			return false;
		}
	}
}
?>
